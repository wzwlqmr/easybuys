Class("trade.virtual.balance",{init:function(e){var a=this;a.options=e;a.virtual=e.virtual;a._init()},_init:function(){var e=this;e._bindInit();e.options.virtualType="balancePwdType"},_bindInit:function(){var r=this;$("#selectOrderBalance").delegate("","click",function(e,a){var t=this;r.virtual.checkPassword(r.options.virtualType,function(e){if(e.resp&&e.resp.resultFlag){r.changeBalanceStatus($(t).prop("checked"))}else{r.virtual._noFundsPassword()}})})},changeBalanceStatus:function(t){var r=this;var e="/virtual/v1/balance";var a=function(e){if(e.resp.resultFlag){if(e.resp.balance<=0){e.resp.balance=$("#canUsedBalanceId span:first").text().replace("￥","")}var a=template("virtual_balance_tmp",e.resp);$("#jdBalance").html(a);a=template("virtual_status_tmp",e.resp);$("#virtual_status").html(a);r.virtual._flushOrderPrice(e.resp.orderPrice);isNeedPaymentPassword();if(t&&$("#useBalanceShowDiscount").val()==0){r.virtual.showErrorDlg("目前订单中已经没有可用于充抵的金额")}}else{if(e.resp.errorMessage){r.virtual.showErrorDlg(getMessage(response.resp))}else{save_Pay(0)}}};$.request({success:a,dataType:"json",method:"PUT",contentType:"application/json;charset=UTF-8",param:{use:t,flowType:$("#flowType").val()},url:e})}});