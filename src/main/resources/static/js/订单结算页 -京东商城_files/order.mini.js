Class("trade.order.api",{init:function(a){var b=this;b.options=a;b._init()},_init:function(){var a=this;a._bindInit()},_bindInit:function(){var a=this;$("#accountCode").delegate("","click",function(c,b){a.sendMsg()})},_renderSkuStock:function(a){var d=a.resp.result;var c=a.param.areaRequest;var b=a.noAvailableSku;var e=c.provinceId;$(".p-state").each(function(){var h=$(this);var f=h.attr("skuId");$.each(d,function(l,j){if(f===l){if(j.preSale){h.html("有货")}else{h.html(j.status)}}});if(null!==b&&undefined!==b&&(b[f]==="1"||b[f]==="")){var i="";switch(e){case $("#hongKongId").val():i="港澳无货";break;case $("#taiWanId").val():i="台湾无货";break;case $("#overSeasId").val():i="海外无货";break}if(i!==""){var g=h.parents(".goods-item").children().first();if(g.hasClass("p-img")){g.append("<span class='p-outofstock hknostock'>"+i+"</span>")}else{g.append("<span class='p-outofstock hknostock'>"+i+"</span>")}}}})},_getAreaIds:function(){var b={"provinceId":1,"cityId":0,"countyId":0,"townId":0};var c=$("#hideAreaIds").val();if(c){var a=c.split("-");if(a.length===4){b.provinceId=a[0];b.cityId=a[1];b.countyId=a[2];b.townId=a[3]}}return b},_getAllSkuList:function(){var a=[];var d=$("#mainSkuIdAndNums").val();if(d){var f=d.split(",");if(f instanceof Array&&f.length>0){for(var c=0;c<f.length-1;c++){var b=f[c].split("_");if(b instanceof Array&&b.length===2){var e={"skuId":b[0],"num":b[1]};a.push(e)}}}}return a},_getLocation:function(){var a={};a.longtitude=$("#consignee-list .consignee-item.item-selected").attr("gcLng");a.latitude=$("#consignee-list .consignee-item.item-selected").attr("gcLat");if(a.longtitude!==undefined&&a.latitude!==undefined){return a}return null},_countDown:function(a){var c=$(".rc-input-tip");if(a.success){c.removeClass("warn");c.html('<i class="succ"></i>验证码已发送至您的手机，有效期2分钟')}else{c.addClass("warn");switch(a.resultCode){case 511:c.html('<i class="warn"></i>短期内不可再次获取，请稍后重试');break;case 510:c.html('<i class="warn"></i>您已超过当日上限，请明天再试');break;case 505:c.html('<i class="warn"></i>短信验证码发送失败');break;default:c.html('<i class="warn"></i>网络异常稍后重试')}}var e=this;var b=$("#accountCode");b.addClass("doing");c.removeClass("hide");b.html("<em> 60s</em>后重新获取");var d=setInterval(function(){if(--e.options.time<=0){clearInterval(d);e.options.time=59;$("#accountCode").removeClass("doing");$("#accountCode").html('<i class="mail-icon"></i>获取短信验证码');$("#accountCode").addClass("hide")}else{$("#accountCode").html("<em>"+e.options.time+"s</em>后重新获取")}},1000)},delegateEvent:function(){$(".comon-tips-btn").bind("click",function(){var a=$(this);if(!a.hasClass("disable")&&$(".rc-input-cont input").val().length>0){jQuery.ajax({type:"POST",dataType:"json",url:"/shopping/order/submitOrder.action",data:$(".risk-control-dialog input:hidden").val()+"&submitOrderParam.msgCode="+$(".rc-input-cont input").val(),cache:false,success:function(s){if(isUserNotLogin(s)){goToLogin();return}if(s.success){if(s.payInfo){$("#direct_pay input[name=orderId]").val(s.payInfo.orderId);$("#direct_pay input[name=orderType]").val(s.payInfo.orderType);$("#direct_pay input[name=toType]").val(s.payInfo.toType);$("#direct_pay input[name=directPayInfoJson]").val(s.payInfo.directPayInfoJson);$("#direct_pay input[name=payMethod]").val(s.payInfo.payMethod);$("#direct_pay input[name=key]").val(s.payInfo.key);$("#direct_pay input[name=countdownTime]").val(s.payInfo.countdownTime);$("#direct_pay input[name=orderSubmitTime]").val(s.payInfo.orderSubmitTime);window.setTimeout("$('#direct_pay').submit();",450);return}if(s.overSea){var k=OrderAppConfig.Protocol+"pcashier.jd.com/cashier/index.action?";var r=s.orderId;var d=s.reqInfo;var p=s.sign;realUrl=k+"orderId="+r+"&reqInfo="+d+"&sign="+p;window.setTimeout("window.location.href=realUrl;",450);return}if(s.goJumpOrderCenter){successUrl=OrderAppConfig.Protocol+"order.jd.com/center/list.action";window.setTimeout('window.location.href=successUrl+"?rd="+Math.random();',450);return}else{successUrl="//success.jd.com/success/success.action";var j=$("#fq").val();if(j){window.location.href=successUrl+"?orderId="+s.orderId+"&rid="+Math.random()+"&fq="+j}else{window.location.href=successUrl+"?orderId="+s.orderId+"&rid="+Math.random()}return}}else{if(s.message!=null&&s.resultCode===600202){var f=$(".rc-input-tip");f.html('<i class="warn"></i>'+s.message);f.removeClass("hide");a.addClass("disable")}else{if(s.message!=null){$.closeDialog();if(s.resultCode==600160){$("#submit_loading").remove();showPriceIncreaseDialog(s.message)}else{if(s.message.indexOf("支付密码不正确")!=-1){$("#submit_loading").remove();$("#pwd-error .error-msg").text(s.message);$("#pwd-error").show();if($(".sixDigitPassword").val()!=undefined&&$(".sixDigitPassword").val().length>0){resetPaypassword()}$("#txt_paypassword").val("");return}else{if(s.message.indexOf("商品无货")!=-1&&!isLocBuy()||(null!==s.noSupportHomeServiceSkuList&&"null"!==s.noSupportHomeServiceSkuList)){$("#submit_loading").remove();var q=s.noStockSkuIds;var n=s.resultCode;if(n=="600182"&&null!=s.noSupportHomeServiceSkuList){q=q==null?(s.noSupportHomeServiceSkuList).toString():(q+","+(s.noSupportHomeServiceSkuList).toString())}showSubmitErrorMessage(s.message);if(!isEmpty(q)){if(isLipinkaPhysical()||isCarO2OFlow()){return}var o=$("#flowType").val();if((o==""||o==10)&&n!=600159){doOutSku(q,n,s.addressVO)}else{window.location.href=cartUrl+"?outSkus="+q+"&rid="+Math.random();return}}}else{if(s.message.indexOf("收货人信息中的省市县选择有误")!=-1){var h=$("#consignee_id").val();$("#submit_loading").remove();showSubmitErrorMessage("亲爱的用户，由于地址已经升级，请重新选择！")}else{if(s.message.indexOf("由于订单金额较大")!=-1){$("#submit_loading").remove();showSubmitErrorMessage(s.message);return}else{if(s.message.indexOf("验证码不正确")!=-1){$("#submit_loading").remove();showSubmitErrorMessage(s.message);getNextCheckCode();return}else{if(s.message.indexOf("正在参与预售活动")!=-1){var m=s.message.indexOf("您购买的商品");var l=s.message.indexOf("正在参与预售活动");var q=s.message.substring(m+6,l);if(!isEmpty(q)){var g="";var c=q.split(",");for(var e=0;e<c.length;e++){g=g+'<a target="_parent" href="http://item.jd.com/'+c[e]+'.html">'+c[e]+"</a>,"}g=g.substring(0,g.length-1);s.message="您购买的商品"+g+"正在参与预售活动,请进入商品详情页单独购买"}$("#submit_loading").remove();showSubmitErrorMessage(s.message)}else{if(s.scaleSkuInfoListVO!=null&&s.scaleSkuInfoListVO.length>0){$("#submit_loading").remove();showScaleBuyDialog(s);return}else{if(s.resultCode==600171){$("#submit_loading").remove();showSamMemberDialog(s.message)}else{if(s.purchaseSkuInfoListVO!=null&&s.purchaseSkuInfoListVO.length>0){$("#submit_loading").remove();showPurchaseList(s.purchaseSkuInfoListVO,"抱歉，以下商品为限购商品，请返回购物车修改 ")}else{if(s.resultCode==600201){$("#submit_loading").remove();param+="&submitOrderParam.msgUuid="+s.msgUuid;var m=template("J_common-risk-control-dialog",{"mobile":s.msgMobile,"param":param});$("body").dialog({title:null,width:520,type:"html",extendMainClass:"common-tips-dialog",source:m,onReady:function(){window.orderApi.unDelegateEvent();window.orderApi.delegateEvent()}})}else{if(s.resultCode==600204){$("#submit_loading").remove();showWindControlMessage(s.message)}else{$("#submit_loading").remove();showSubmitErrorMessage(s.message);return}}}}}}}}}}}}}else{$.closeDialog();$("#submit_loading").remove();showSubmitErrorMessage("亲爱的用户请不要频繁点击, 请稍后重试...");return}}}}})}else{}});$(".rc-input-cont input").bind("input propertychange",function(){var a=$(this);if(a.val().length===6){$(".rc-btn").removeClass("disable")}else{$(".rc-btn").addClass("disable");$(".rc-input-tip").addClass("warn");$(".rc-input-tip").html('<i class="warn"></i>短信验证码为6位')}})},unDelegateEvent:function(){$(".comon-tips-btn").unbind("click");$(".rc-input-cont input").unbind("input propertychange")},loadSkuStock:function(b){var d=this;var c="//trade.jd.com/api/v1/batch/stock";var f=d._renderSkuStock;var e={"skuNumList":d._getAllSkuList(),"areaRequest":d._getAreaIds()};var a=d._getLocation();if(a!=null){e.coordnateRequest=a}$.request({url:c,param:e,method:"POST",success:f,noAvailableSku:b})},sendMsg:function(){var c=this;var a="/order/v1/account/code";var b=function(d){if(d.resp){if(!$("#accountCode").hasClass("doing")){c._countDown(d.resp)}}};$.request({url:a,success:b})},loadCarModelName:function(){var b=$(".model_id_hidden");if(b&&b.length>0){var a="/api/v1/getModelName";var c="";$.each(b,function(e,f){if($(this).val()&&$(this).val()!=""){if(c!=""){c+=","}c+=$(this).val()}});if(c==""){console.log("has no modelId");return}var d={"modelIds":c};$.post(a,d,this._renderModelName)}},_renderModelName:function(a){try{if(a&&a.success){var b=a.modelList;if(b){$.each(b,function(f,g){if(g){var d=g.brandName+" "+g.seriesName;var e=$(".model_name_dispaly_div_"+g.id);if(e&&e.length>0){$.each(e,function(i,h){$(this).append("<strong>车型：</strong>\n");$(this).append('<span class="p-extra-tips" data-tips="'+d+'">'+d+"</span>")})}}})}}}catch(c){}}});